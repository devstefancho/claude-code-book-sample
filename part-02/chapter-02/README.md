# Chapter 02. 데이터베이스 연동하기

> 프롬프트: [prompts.md](./prompts.md) | 코드: [code.md](./code.md)

지난 챕터에서 만든 커스텀 슬래시 커맨드를 활용하여 데이터베이스를 연동합니다.

## 현재 상황과 목표

현재 칸반보드는 브라우저의 로컬스토리지에만 저장되어 있어, 다른 브라우저나 기기에서 접속하면 데이터가 유지되지 않습니다. Supabase를 사용하여 데이터베이스를 연동하고 실제 데이터가 저장되도록 기능을 확장합니다.

## Supabase란 무엇인가?

Supabase는 서버를 직접 만들지 않고도 데이터베이스와 로그인 기능 등을 쉽게 사용할 수 있게 해주는 서비스입니다.

- 복잡한 서버 설정 없이 데이터를 안전하게 저장하고 불러올 수 있음
- 클로드 코드와 잘 연동됨
- 무료 티어 제공으로 사이드 프로젝트나 MVP 개발에 적합

## Supabase MCP 활용하기

MCP(Model Context Protocol)를 사용하면 클로드 코드가 직접 데이터베이스에 접속하여:
- 테이블 스키마 파악
- 필요한 쿼리 실행
- 적절한 테이블과 정책(Policy) 생성

MVP 단계에서 MCP는 폭발적인 생산성을 제공합니다.

## Supabase 프로젝트 생성 및 MCP 설정하기

### 설정 단계

1. **Supabase 가입 및 로그인하기**: GitHub 계정으로 간편 로그인 가능
2. **대시보드에서 새 프로젝트 생성하기**: [New Project] 클릭
3. **새 프로젝트 정보넣기**: Project name, Database password, Region(Asia-Pacific)
4. **Connect 메뉴 진입하기**: 헤더의 [Connect] 클릭
5. **MCP 설정 탭 선택하기**: [MCP] 클릭
6. **Client 설정을 Claude Code로 변경하기**
7. **설정 파일 저장**: JSON 코드를 `.mcp.json`으로 저장
8. **MCP 연결 상태 확인 및 연결 허용하기**: `/mcp` 명령어로 확인

## 새로운 Git Branch 생성하기

데이터베이스 작업을 위한 별도 브랜치를 생성합니다. 이 브랜치명은 스펙, 플랜, 태스크 문서에서도 사용됩니다.

## 데이터베이스 작업을 위해서 다시 생성하는 세 가지 문서

브랜치에 따라 문서가 독립적으로 관리됩니다:
- `docs/frontend-setup/` - 프론트엔드 관련 문서
- `docs/db-integration/` - 데이터베이스 관련 문서

커맨드 프롬프트의 `{current_branch}`로 인해 현재 브랜치에 따라 문서 생성위치가 결정됩니다.

## 스펙 문서 만들기

핵심 기능 정리:
1. 로그인을 할 수 있음 (이메일/패스워드 인증)
2. 사용자별로 대시보드 제공

스펙 문서 생성 결과:
- 이메일/패스워드 인증
- 사용자별 칸반보드
- 데이터 격리

## 플랜 문서 만들기

플랜 파일에 포함되는 내용:
- 통합 기술 구현 계획
- 시스템 아키텍처
- 디렉토리 구조
- RLS(Row-Level Security) 정책
- Tech Stack
- Typescript Interfaces
- Database Models
- 보안 고려사항

## 태스크 문서 만들기

/sdd:tasks 커맨드는 스펙과 플랜을 분석하여 구체적인 태스크 목록을 생성합니다. 의존성을 고려하여 작업 순서도 자동으로 정렬됩니다.

## 임플먼트로 코드 구현하기

/sdd:implement 커맨드로 태스크 목록의 순서에 따라 코드를 구현합니다. Supabase에서 데이터베이스 생성과 RLS 설정은 클로드 코드가 Supabase MCP를 사용하여 자동 처리합니다.

## 칸반보드 서비스 최종 테스트

### 테스트 순서

1. **서버 실행하기**
2. **회원가입**: 실제 사용하는 이메일로 가입 (확인 메일 전송됨)
3. **초대 이메일 확인**: [Confirm your mail] 링크 클릭
4. **로그인하기**
5. **칸반보드 아이템 생성 테스트**
6. **로그아웃**
7. **새로운 유저로 회원가입 및 로그인**: 유저마다 독립적인 대시보드 확인

### 초대 이메일 전송에 실패한 경우

Supabase에서 이메일 확인을 OFF 하기:
- Authentication > Sign In / Providers > Confirm email OFF

**Note**: Supabase의 기본 메일 시스템은 테스트용이므로 전송 실패가 발생할 수 있습니다. 안정적인 서비스 운영을 위해서는 외부 SMTP 연동이 필요합니다.
